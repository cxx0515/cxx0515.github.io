<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能网页工作便签 - 2025</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Markdown支持库 -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <style>
        :root {
            /* 默认配色方案 */
            --primary-color: #6366f1;
            --primary-gradient: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            --secondary-color: #f8fafc;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --card-bg: rgba(255, 255, 255, 0.95);
            --shadow-color: rgba(99, 102, 241, 0.1);
            --success-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --note-bg: #ffffff;
            --border-color: #e2e8f0;
            --hover-color: #f1f5f9;
            --completed-color: #94a3b8;
        }

        .theme-purple {
            --primary-color: #6366f1;
            --primary-gradient: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            --shadow-color: rgba(99, 102, 241, 0.15);
        }

        .theme-blue {
            --primary-color: #3b82f6;
            --primary-gradient: linear-gradient(135deg, #3b82f6 0%, #06b6d4 100%);
            --shadow-color: rgba(59, 130, 246, 0.15);
        }

        .theme-green {
            --primary-color: #10b981;
            --primary-gradient: linear-gradient(135deg, #10b981 0%, #84cc16 100%);
            --shadow-color: rgba(16, 185, 129, 0.15);
        }

        .theme-pink {
            --primary-color: #ec4899;
            --primary-gradient: linear-gradient(135deg, #ec4899 0%, #d946ef 100%);
            --shadow-color: rgba(236, 72, 153, 0.15);
        }

        .theme-orange {
            --primary-color: #f97316;
            --primary-gradient: linear-gradient(135deg, #f97316 0%, #f59e0b 100%);
            --shadow-color: rgba(249, 115, 22, 0.15);
        }

        .theme-dark {
            --primary-color: #8b5cf6;
            --primary-gradient: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
            --secondary-color: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --card-bg: rgba(30, 41, 59, 0.9);
            --shadow-color: rgba(0, 0, 0, 0.3);
            --note-bg: rgba(51, 65, 85, 0.8);
            --border-color: #475569;
            --hover-color: #334155;
            --completed-color: #64748b;
        }
        
        /* 红色主题 - 激情活力 */
        .theme-red {
            --primary-color: #ef4444;
            --primary-gradient: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            --shadow-color: rgba(239, 68, 68, 0.15);
        }

        /* 青色主题 - 清新科技 */
        .theme-cyan {
            --primary-color: #06b6d4;
            --primary-gradient: linear-gradient(135deg, #06b6d4 0%, #0ea5e9 100%);
            --shadow-color: rgba(6, 182, 212, 0.15);
        }

        /* 琥珀色主题 - 温暖明亮 */
        .theme-amber {
            --primary-color: #f59e0b;
            --primary-gradient: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            --shadow-color: rgba(245, 158, 11, 0.15);
        }

        /* 靛蓝色主题 - 专业深邃 */
        .theme-indigo {
            --primary-color: #4f46e5;
            --primary-gradient: linear-gradient(135deg, #4f46e5 0%, #3730a3 100%);
            --shadow-color: rgba(79, 70, 229, 0.15);
        }

        /* 玫瑰色主题 - 温柔浪漫 */
        .theme-rose {
            --primary-color: #f43f5e;
            --primary-gradient: linear-gradient(135deg, #f43f5e 0%, #e11d48 100%);
            --shadow-color: rgba(244, 63, 94, 0.15);
        }

        /* 青绿色主题 - 时尚潮流 */
        .theme-teal {
            --primary-color: #14b8a6;
            --primary-gradient: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%);
            --shadow-color: rgba(20, 184, 166, 0.15);
        }

        /* 紫红色主题 - 奢华高贵 */
        .theme-fuchsia {
            --primary-color: #d946ef;
            --primary-gradient: linear-gradient(135deg, #d946ef 0%, #a855f7 100%);
            --shadow-color: rgba(217, 70, 239, 0.15);
        }

        /* 石板灰主题 - 简约现代 */
        .theme-slate {
            --primary-color: #64748b;
            --primary-gradient: linear-gradient(135deg, #64748b 0%, #475569 100%);
            --shadow-color: rgba(100, 116, 139, 0.15);
        }

        /* 森林绿主题 - 自然生态 */
        .theme-forest {
            --primary-color: #059669;
            --primary-gradient: linear-gradient(135deg, #059669 0%, #047857 100%);
            --shadow-color: rgba(5, 150, 105, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        
        body {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            color: var(--text-primary);
            line-height: 1.6;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
            min-height: 100vh;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 25px 30px;
            background: var(--primary-gradient);
            border-radius: 20px;
            box-shadow: 0 10px 40px var(--shadow-color);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
        }
        
        h1 {
            color: white;
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 32px;
            font-weight: 700;
        }
        
        h1 i {
            color: white;
        }
        
        .stats {
            color: rgba(255, 255, 255, 0.9);
        }
        
        .stat-item {
            color: rgba(255, 255, 255, 0.9);
        }
        
        .stat-number {
            color: white;
            font-weight: 700;
            font-size: 18px;
        }
        
        .theme-selector {
            position: relative;
            width: 180px;
        }
        
        .theme-selector select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            font-size: 14px;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            cursor: pointer;
            appearance: none;
            font-weight: 500;
        }
        
        .theme-selector select:focus {
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.1);
        }
        
        .theme-selector i {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: white;
        }
        
        .theme-selector select option {
            background: #333;
            color: white;
        }
        
        /* 深色主题下的.header样式 */
        .theme-dark .header {
            background: var(--primary-gradient);
            color: white;
        }

        .theme-dark .theme-selector select {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        /* 确保在所有主题下，.header内的文字都是可见的 */
        .theme-purple .header,
        .theme-blue .header,
        .theme-green .header,
        .theme-pink .header,
        .theme-orange .header,
        .theme-red .header,
        .theme-cyan .header,
        .theme-amber .header,
        .theme-indigo .header,
        .theme-rose .header,
        .theme-teal .header,
        .theme-fuchsia .header,
        .theme-slate .header,
        .theme-forest .header {
            background: var(--primary-gradient);
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
            align-items: center;
            background: var(--card-bg);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 40px var(--shadow-color);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .filter-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
            padding: 15px 20px;
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: 0 5px 20px var(--shadow-color);
            border: 1px solid var(--border-color);
        }
        
        .filter-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            flex: 1;
        }
        
        .filter-btn {
            padding: 10px 20px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            background: var(--card-bg);
            color: var(--text-primary);
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 120px;
            text-align: center;
        }
        
        .filter-btn.active {
            background: var(--primary-gradient);
            color: white;
            border-color: var(--primary-color);
        }
        
        .filter-btn:hover:not(.active) {
            background: var(--hover-color);
            border-color: var(--primary-color);
        }
        
        .search-sort-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            flex: 1;
        }
        
        .search-box {
            flex: 1;
            min-width: 300px;
            position: relative;
        }
        
        .search-box input {
            width: 100%;
            padding: 15px 20px 15px 50px;
            border: 2px solid var(--border-color);
            border-radius: 15px;
            font-size: 16px;
            background: var(--card-bg);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }
        
        .search-box input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .search-box i {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }
        
        .sort-box {
            min-width: 220px;
        }
        
        .sort-box select {
            width: 100%;
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: 15px;
            font-size: 16px;
            background: var(--card-bg);
            color: var(--text-primary);
            cursor: pointer;
            transition: border-color 0.3s;
            font-weight: 500;
        }
        
        .sort-box select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        button {
            padding: 14px 24px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 15px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .primary-btn {
            background: var(--primary-gradient);
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .primary-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s;
        }
        
        .primary-btn:hover::after {
            left: 100%;
        }
        
        .primary-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.3);
        }
        
        .secondary-btn {
            background: var(--secondary-color);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
        }
        
        .secondary-btn:hover {
            background: var(--hover-color);
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }
        
        .danger-btn {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        
        .danger-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.3);
        }
        
        .notes-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 30px;
            margin-top: 20px;
            margin-bottom: 30px;
        }
        
        .note {
            background: var(--note-bg);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px var(--shadow-color);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            flex-direction: column;
            height: 100%;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .note.completed {
            opacity: 0.8;
            transform: scale(0.98);
        }
        
        .note.completed .note-title {
            text-decoration: line-through;
            color: var(--completed-color);
        }
        
        .note.completed .note-content {
            color: var(--completed-color);
        }
        
        .note.completed::before {
            background: var(--completed-color);
        }
        
        .note.completed .note-checkmark {
            display: block;
        }
        
        .note-checkmark {
            position: absolute;
            top: 15px;
            right: 15px;
            color: var(--success-color);
            font-size: 24px;
            display: none;
        }
        
        .note::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: var(--primary-gradient);
            transition: background 0.3s ease;
        }
        
        .note:hover {
            <!-- transform: translateY(-10px) scale(1.02); -->
            <!-- box-shadow: 0 20px 40px var(--shadow-color); -->
			/* 使用相对定位来实现上浮效果 */
			position: relative;
			top: -1px;
			/* 添加边框效果 - 使用主色调 */
			border: 2px solid var(--primary-color);
			/* 添加边框发光效果 */
			box-shadow: 0 10px 20px var(--shadow-color);
        }
        
        .note.completed:hover {
            <!-- transform: translateY(-5px) scale(1.01); -->
			position: relative;
			top: -1px;
			/* 添加边框效果 - 使用完成状态的灰色 */
			border: 2px solid var(--completed-color);
			box-shadow: 0 8px 16px var(--shadow-color);
        }
        
        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }
        
        .note-title {
            font-size: 22px;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.3;
            flex: 1;
            padding-right: 40px;
            transition: color 0.3s ease, text-decoration 0.3s ease;
        }
        
        .note-actions {
            display: flex;
            gap: 8px;
        }
        
        .note-action-btn {
            background: rgba(99, 102, 241, 0.1);
            border: none;
            cursor: pointer;
            color: var(--primary-color);
            padding: 8px;
            border-radius: 10px;
            font-size: 16px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .note-action-btn.complete-btn {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
        }
        
        .note-action-btn.complete-btn:hover {
            background: var(--success-color);
            color: white;
        }
        
        .note-action-btn:hover {
            background: var(--primary-color);
            color: white;
            transform: rotate(15deg);
        }
        
        .note-content {
            flex: 1;
            color: var(--text-secondary);
            line-height: 1.7;
            margin-bottom: 20px;
            font-size: 15px;
            max-height: 200px;
            overflow-y: auto;
            padding-right: 5px;
        }
        
        .note-content::-webkit-scrollbar {
            width: 4px;
        }
        
        .note-content::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
        }
        
        .note-content::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 10px;
        }
        
        .note-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .tag {
            background: rgba(99, 102, 241, 0.1);
            color: var(--primary-color);
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .tag::before {
            content: '#';
            opacity: 0.7;
        }
        
        .note-date {
            color: var(--text-secondary);
            font-size: 14px;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .note-date i {
            color: var(--primary-color);
        }
        
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: var(--text-secondary);
            grid-column: 1 / -1;
        }
        
        .empty-state i {
            font-size: 80px;
            margin-bottom: 25px;
            opacity: 0.3;
        }
        
        .empty-state h3 {
            font-size: 24px;
            margin-bottom: 15px;
            color: var(--text-primary);
        }
        
        .pagination-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin: 30px 0;
            padding: 20px;
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: 0 5px 20px var(--shadow-color);
        }
        
        .pagination-btn {
            padding: 10px 18px;
            border: 2px solid var(--border-color);
            background: var(--card-bg);
            color: var(--text-primary);
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 40px;
            text-align: center;
        }
        
        .pagination-btn:hover:not(:disabled) {
            background: var(--primary-gradient);
            color: white;
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }
        
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .pagination-btn.active {
            background: var(--primary-gradient);
            color: white;
            border-color: var(--primary-color);
        }
        
        .pagination-dots {
            color: var(--text-secondary);
            font-size: 18px;
            padding: 0 5px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .modal-content {
            background: var(--card-bg);
            border-radius: 25px;
            width: 90%;
            max-width: 650px;
            max-height: 85vh;
            overflow: hidden;
            padding: 0;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: modalSlideIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            flex-direction: column;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px 20px 30px;
            border-bottom: 1px solid var(--border-color);
            background: var(--card-bg);
            flex-shrink: 0;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .modal-title {
            font-size: 28px;
            color: var(--text-primary);
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--text-secondary);
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .close-btn:hover {
            background: var(--hover-color);
            color: var(--primary-color);
            transform: rotate(90deg);
        }
        
        .modal-body {
            padding: 30px;
            overflow-y: auto;
            flex: 1;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 15px;
        }
        
        .form-group input, 
        .form-group textarea {
            width: 100%;
            padding: 16px;
            border: 2px solid var(--border-color);
            border-radius: 15px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: var(--card-bg);
            color: var(--text-primary);
        }
        
        .form-group textarea {
            min-height: 180px;
            resize: vertical;
        }
        
        .form-group input:focus, 
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .color-options {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            cursor: pointer;
            border: 3px solid var(--border-color);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .color-option:hover {
            transform: scale(1.1);
        }
        
        .color-option.selected::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--text-secondary);
            font-weight: bold;
            font-size: 14px;
        }
        
        .stats {
            display: flex;
            gap: 30px;
            color: var(--text-secondary);
            font-size: 15px;
            margin-top: 15px;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .stat-number {
            font-weight: 700;
            color: white;
            font-size: 18px;
        }
        
        .floating-buttons {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 100;
        }
        
        .floating-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            background: var(--primary-gradient);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
            transition: all 0.3s ease;
        }
        
        .floating-btn:hover {
            transform: scale(1.1) rotate(15deg);
            box-shadow: 0 15px 40px rgba(99, 102, 241, 0.4);
        }
        
        .toast {
            position: fixed;
            top: 30px;
            right: 30px;
            padding: 18px 25px;
            background: var(--card-bg);
            color: var(--text-primary);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            transform: translateX(150%);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border-left: 5px solid var(--primary-color);
            backdrop-filter: blur(10px);
            max-width: 350px;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast-content {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .toast-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
        }
        
        /* 新增：导入文件相关样式 */
        .file-import-area {
            border: 2px dashed var(--border-color);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .file-import-area:hover {
            border-color: var(--primary-color);
            background: var(--hover-color);
        }
        
        .file-import-area.dragover {
            border-color: var(--primary-color);
            background: rgba(99, 102, 241, 0.1);
            transform: scale(1.02);
        }
        
        .file-import-icon {
            font-size: 48px;
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .file-input-label {
            display: inline-block;
            padding: 12px 24px;
            background: var(--primary-gradient);
            color: white;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 15px;
            transition: all 0.3s ease;
        }
        
        .file-input-label:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.3);
        }
        
        .file-input {
            display: none;
        }
        
        .file-name {
            margin-top: 10px;
            font-size: 14px;
            color: var(--text-secondary);
            word-break: break-all;
        }
        
        /* 新增：定时导出设置样式 */
        .auto-export-settings {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            box-shadow: 0 5px 20px var(--shadow-color);
        }
        
        .settings-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .settings-row {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .settings-label {
            min-width: 120px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .settings-control {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .settings-input {
            padding: 10px 15px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            background: var(--card-bg);
            color: var(--text-primary);
            font-size: 14px;
            width: 100px;
        }
        
        .settings-status {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid var(--border-color);
        }
        
        .settings-info {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 10px;
            font-style: italic;
        }
        
        /* 新增：浮动设置按钮 */
        .floating-settings-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
            transition: all 0.3s ease;
            position: fixed;
            bottom: 30px;
            left: 30px;
            z-index: 100;
        }
        
        .floating-settings-btn:hover {
            transform: scale(1.1) rotate(15deg);
            box-shadow: 0 15px 40px rgba(99, 102, 241, 0.4);
        }
        
        /* Markdown 样式 */
        .note-content.markdown {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.7;
        }

        .note-content.markdown h1,
        .note-content.markdown h2,
        .note-content.markdown h3 {
            margin-top: 1.5em;
            margin-bottom: 0.8em;
            color: var(--text-primary);
            font-weight: 700;
        }

        .note-content.markdown h1 {
            font-size: 1.8em;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 0.3em;
        }

        .note-content.markdown h2 {
            font-size: 1.5em;
        }

        .note-content.markdown h3 {
            font-size: 1.3em;
        }

        .note-content.markdown p {
            margin-bottom: 1em;
        }

        .note-content.markdown ul,
        .note-content.markdown ol {
            margin: 0.5em 0;
            padding-left: 2em;
            margin-bottom: 1em;
        }

        .note-content.markdown li {
            margin-bottom: 0.3em;
        }

        .note-content.markdown blockquote {
            border-left: 4px solid var(--primary-color);
            margin: 1em 0;
            padding: 0.5em 1em;
            background: var(--hover-color);
            border-radius: 0 8px 8px 0;
            font-style: italic;
        }

        .note-content.markdown code {
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            background: var(--hover-color);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.9em;
            color: var(--primary-color);
        }

        .note-content.markdown pre {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1em;
            margin: 1em 0;
            overflow-x: auto;
        }

        .note-content.markdown pre code {
            background: none;
            padding: 0;
            border-radius: 0;
            color: inherit;
        }

        .note-content.markdown table {
            border-collapse: collapse;
            width: 100%;
            margin: 1em 0;
            border: 1px solid var(--border-color);
        }

        .note-content.markdown th,
        .note-content.markdown td {
            border: 1px solid var(--border-color);
            padding: 0.5em 1em;
            text-align: left;
        }

        .note-content.markdown th {
            background: var(--hover-color);
            font-weight: 600;
        }

        .note-content.markdown a {
            color: var(--primary-color);
            text-decoration: none;
            border-bottom: 1px solid transparent;
            transition: border-color 0.3s;
        }

        .note-content.markdown a:hover {
            border-bottom: 1px solid var(--primary-color);
        }

        .note-content.markdown img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 1em 0;
        }

        .note-content.markdown hr {
            border: none;
            border-top: 2px solid var(--border-color);
            margin: 2em 0;
        }

        /* 语法高亮 */
        .hljs {
            background: transparent !important;
            padding: 0 !important;
        }
        
        /* Markdown格式徽章 */
        .format-badge {
            display: inline-block;
            background: var(--primary-color);
            color: white;
            font-size: 11px;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 8px;
            vertical-align: middle;
        }
        
        /* ==================== 所有模态框滚动优化 ==================== */
        /* 模态框内容滚动条样式 */
        .modal-body::-webkit-scrollbar {
            width: 8px;
        }
        
        .modal-body::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
            margin: 10px 0;
        }
        
        .modal-body::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 10px;
        }
        
        .modal-body::-webkit-scrollbar-thumb:hover {
            background: var(--primary-color);
            opacity: 0.8;
        }
        
        /* 文本区域滚动优化 */
        #note-content, #import-data {
            min-height: 150px;
            max-height: 300px;
            overflow-y: auto !important;
            resize: vertical;
        }
        
        #note-content::-webkit-scrollbar,
        #import-data::-webkit-scrollbar {
            width: 6px;
        }
        
        #note-content::-webkit-scrollbar-track,
        #import-data::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
        }
        
        #note-content::-webkit-scrollbar-thumb,
        #import-data::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 10px;
        }
        
        /* ==================== 移动端模态框优化 ==================== */
        @media (max-width: 768px) {
            .modal-content {
                width: 95%;
                max-width: 95%;
                max-height: 90vh;
                border-radius: 20px;
            }
            
            .modal-header {
                padding: 20px 25px 15px 25px;
            }
            
            .modal-body {
                padding: 25px;
                -webkit-overflow-scrolling: touch; /* iOS平滑滚动 */
            }
            
            .modal-title {
                font-size: 24px;
            }
            
            .close-btn {
                width: 36px;
                height: 36px;
                font-size: 24px;
                background: rgba(0, 0, 0, 0.1);
            }
            
            .theme-dark .close-btn {
                background: rgba(255, 255, 255, 0.1);
            }
            
            .form-group {
                margin-bottom: 20px;
            }
            
            .form-group input,
            .form-group textarea {
                padding: 14px;
                font-size: 15px;
                border-radius: 12px;
            }
            
            .form-group textarea {
                min-height: 150px;
            }
            
            .color-options {
                gap: 12px;
            }
            
            .color-option {
                width: 36px;
                height: 36px;
                border-radius: 10px;
            }
            
            /* 调整文件导入区域 */
            .file-import-area {
                padding: 20px 15px;
            }
            
            .file-import-icon {
                font-size: 36px;
                margin-bottom: 10px;
            }
            
            .settings-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .settings-label {
                min-width: auto;
                margin-bottom: 5px;
            }
            
            .settings-control {
                width: 100%;
                justify-content: space-between;
            }
            
            /* 优化模态框滚动条 */
            .modal-body::-webkit-scrollbar {
                width: 4px;
            }
            
            /* 优化文本区域高度 */
            #note-content, #import-data {
                min-height: 120px;
                max-height: 200px;
            }
            
            /* 优化设置模态框中的开关样式 */
            .settings-control {
                flex-wrap: wrap;
            }
            
            .settings-control select {
                width: 100%;
                margin-bottom: 10px;
            }
            
            #next-export-time {
                width: 100%;
                font-size: 13px;
            }
            
            /* 优化Markdown预览在移动端 */
            .note-content.markdown {
                font-size: 14px;
            }
            
            .note-content.markdown h1 {
                font-size: 1.4em;
            }
            
            .note-content.markdown h2 {
                font-size: 1.3em;
            }
            
            .note-content.markdown h3 {
                font-size: 1.2em;
            }
            
            /* ==================== 移动端filter-controls优化 ==================== */
            .filter-controls {
                flex-direction: column;
                align-items: stretch;
                gap: 15px;
                padding: 20px;
            }
            
            .filter-buttons {
                width: 100%;
                justify-content: space-between;
            }
            
            .filter-btn {
                flex: 1;
                min-width: calc(50% - 5px);
                padding: 12px 8px;
                font-size: 14px;
                text-align: center;
                margin-bottom: 8px;
            }
            
            .page-size-control {
                width: 100%;
                margin-left: 0 !important;
                justify-content: space-between;
                padding-top: 10px;
                border-top: 1px solid var(--border-color);
            }
        }

        @media (max-width: 480px) {
            .modal-content {
                width: 100%;
                max-width: 100%;
                max-height: 95vh;
                margin: 10px;
                border-radius: 15px;
            }
            
            .modal-title {
                font-size: 22px;
            }
            
            .modal-body {
                padding: 20px;
            }
            
            .form-group input,
            .form-group textarea {
                padding: 12px;
                font-size: 16px; /* 防止iOS缩放 */
                border-radius: 10px;
            }
            
            .form-group textarea {
                min-height: 120px;
            }
            
            .form-group label {
                font-size: 14px;
                margin-bottom: 8px;
            }
            
            .color-option {
                width: 32px;
                height: 32px;
                border-radius: 8px;
            }
            
            /* 调整按钮组 */
            .form-group + div {
                margin-top: 15px;
            }
            
            button {
                padding: 12px 16px;
                font-size: 14px;
                border-radius: 10px;
            }
            
            /* 确保模态框在视口中居中 */
            .modal {
                padding: 10px;
                align-items: flex-start;
                padding-top: 20px;
            }
            
            /* 优化文件导入区域在移动端的显示 */
            .file-input-label {
                padding: 10px 16px;
                font-size: 14px;
            }
            
            .file-name {
                font-size: 12px;
                line-height: 1.4;
            }
            
            /* 进一步优化文本区域高度 */
            #note-content, #import-data {
                min-height: 100px;
                max-height: 150px;
            }
            
            /* ==================== 小屏幕filter-controls优化 ==================== */
            .filter-controls {
                padding: 15px;
                gap: 12px;
            }
            
            .filter-buttons {
                flex-direction: column;
                gap: 8px;
            }
            
            .filter-btn {
                width: 100%;
                min-width: 100%;
                padding: 14px 10px;
                margin-bottom: 0;
            }
            
            .page-size-control {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
                padding-top: 12px;
            }
            
            .page-size-control span {
                width: 100%;
                margin-bottom: 5px;
            }
            
            .page-size-control select {
                width: 100%;
            }
        }
        
        /* 添加：模态框滚动锁定 */
        body.modal-open {
            overflow: hidden;
        }

        /* 优化输入框在iOS上的显示 */
        input, textarea, select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        /* 防止移动端输入框缩放 */
        @supports (-webkit-touch-callout: none) {
            input, textarea, select {
                font-size: 16px !important;
            }
        }
        
        /* 优化设置模态框中的开关样式 */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border-color);
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(24px);
        }
        
        @media (max-width: 1024px) {
            .notes-container {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 20px;
                padding: 20px;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
                padding: 20px;
            }
            
            .search-sort-container {
                flex-direction: column;
            }
            
            .search-box, .sort-box, .theme-selector {
                width: 100%;
            }
            
            .notes-container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .floating-buttons {
                bottom: 20px;
                right: 20px;
            }
            
            .floating-settings-btn {
                bottom: 100px;
                left: 20px;
            }
            
            .pagination-container {
                flex-wrap: wrap;
            }
        }
        
        @media (max-width: 640px) and (min-width: 481px) {
            .filter-buttons {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
            
            .filter-btn:nth-child(5) {
                grid-column: 1 / -1;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 15px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .buttons {
                flex-direction: column;
                width: 100%;
            }
            
            button {
                width: 100%;
                justify-content: center;
            }
            
            .note {
                padding: 20px;
            }
            
            .note-title {
                font-size: 20px;
            }
            
            .settings-row {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .floating-buttons {
                bottom: 20px;
                right: 20px;
            }
            
            .floating-settings-btn {
                bottom: 100px;
                left: 20px;
            }
        }
    </style>
</head>
<body class="theme-purple">
    <div class="header">
        <div>
            <h1><i class="fas fa-sticky-note"></i> 智能网页工作便签</h1>
            <div class="stats">
                <div class="stat-item">
                    <span class="stat-number" id="note-count">0</span>
                    <span>个便签</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="completed-count">0</span>
                    <span>已完成</span>
                </div>
                <div class="stat-item">
                    <i class="fas fa-sort-amount-down"></i>
                    <span id="sort-indicator">按日期倒序排列</span>
                </div>
            </div>
        </div>
        
        <div class="theme-selector">
            <i class="fas fa-palette"></i>
            <select id="theme-select">
                <option value="theme-purple">紫色主题</option>
                <option value="theme-blue">蓝色主题</option>
                <option value="theme-green">绿色主题</option>
                <option value="theme-pink">粉色主题</option>
                <option value="theme-orange">橙色主题</option>
                <option value="theme-dark">深色主题</option>
                <!-- 新增主题选项 -->
                <option value="theme-red">红色主题</option>
                <option value="theme-cyan">青色主题</option>
                <option value="theme-amber">琥珀色主题</option>
                <option value="theme-indigo">靛蓝色主题</option>
                <option value="theme-rose">玫瑰色主题</option>
                <option value="theme-teal">青绿色主题</option>
                <option value="theme-fuchsia">紫红色主题</option>
                <option value="theme-slate">石板灰主题</option>
                <option value="theme-forest">森林绿主题</option>
            </select>
        </div>
    </div>
    
    <div class="controls">
        <div class="search-sort-container">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="search-input" placeholder="搜索便签标题、内容或标签...">
            </div>
            
            <div class="sort-box">
                <select id="sort-select">
                    <option value="date-desc">按日期倒序 (最新的在前)</option>
                    <option value="date-asc">按日期正序 (最早的在前)</option>
                    <option value="title-asc">按标题 A-Z</option>
                    <option value="title-desc">按标题 Z-A</option>
                    <option value="completed">按完成状态</option>
                </select>
            </div>
        </div>
        
        <div class="buttons">
            <button class="primary-btn" id="add-note-btn">
                <i class="fas fa-plus"></i> 新建便签
            </button>
            <button class="secondary-btn" id="import-btn">
                <i class="fas fa-upload"></i> 导入数据
            </button>
            <button class="secondary-btn" id="export-btn">
                <i class="fas fa-download"></i> 导出数据
            </button>
            <button class="danger-btn" id="clear-all-btn">
                <i class="fas fa-trash-alt"></i> 清空所有
            </button>
        </div>
    </div>
    
    <div class="filter-controls">
        <div class="filter-buttons">
            <button class="filter-btn active" data-filter="all">全部便签</button>
            <button class="filter-btn" data-filter="active">未完成</button>
            <button class="filter-btn" data-filter="completed">已完成</button>
            <button class="filter-btn" data-filter="important" title="包含重要标签的便签">
                <i class="fas fa-star"></i> 重要
            </button>
            <button class="filter-btn" data-filter="today" title="今天创建的便签">
                <i class="fas fa-calendar-day"></i> 今天
            </button>
        </div>
        
        <div class="page-size-control" style="display: flex; align-items: center; gap: 15px; margin-left: auto;">
            <span style="font-size: 14px; color: var(--text-secondary);">每页显示:</span>
            <select id="page-size-select" style="padding: 8px 12px; border-radius: 8px; border: 2px solid var(--border-color); background: var(--card-bg); color: var(--text-primary);">
                <option value="6">6个</option>
                <option value="9" selected>9个</option>
                <option value="12">12个</option>
                <option value="15">15个</option>
            </select>
        </div>
    </div>
    
    <div class="notes-container" id="notes-container">
        <!-- 便签将通过JS动态添加到这里 -->
    </div>
    
    <!-- 分页控件 -->
    <div class="pagination-container" id="pagination-container" style="display: none;">
        <!-- 分页按钮将通过JS动态生成 -->
    </div>
    
    <!-- 新建/编辑便签的模态框 -->
    <div class="modal" id="note-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modal-title">新建便签</h2>
                <button class="close-btn" id="close-modal">&times;</button>
            </div>
            
            <div class="modal-body">
                <form id="note-form">
                    <div class="form-group">
                        <label for="note-title">标题</label>
                        <input type="text" id="note-title" required maxlength="100" placeholder="输入便签标题...">
                    </div>
                    
                    <div class="form-group">
                        <label for="note-content">内容</label>
                        <textarea id="note-content" required maxlength="2000" placeholder="输入便签内容..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="note-tags">标签 (用逗号分隔)</label>
                        <input type="text" id="note-tags" placeholder="工作, 重要, 想法">
                    </div>
                    
                    <div class="form-group">
                        <label for="note-format">格式</label>
                        <div style="display: flex; gap: 20px; align-items: center; margin-top: 10px;">
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="radio" name="note-format" value="plain" checked> 
                                <span style='white-space: nowrap;'>纯文本</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="radio" name="note-format" value="markdown"> 
                                <span style='white-space: nowrap;'>Markdown</span>
                            </label>
                        </div>
                        <input type="hidden" id="note-format" value="plain">
                    </div>
                    
                    <div class="form-group">
                        <label>便签颜色</label>
                        <div class="color-options">
                            <div class="color-option selected" data-color="#ffffff" style="background-color: #ffffff;"></div>
                            <div class="color-option" data-color="#e6f7ff" style="background-color: #e6f7ff;"></div>
                            <div class="color-option" data-color="#f0ffe6" style="background-color: #f0ffe6;"></div>
                            <div class="color-option" data-color="#fff9e6" style="background-color: #fff9e6;"></div>
                            <div class="color-option" data-color="#ffe6e6" style="background-color: #ffe6e6;"></div>
                            <div class="color-option" data-color="#f5e6ff" style="background-color: #f5e6ff;"></div>
                        </div>
                        <input type="hidden" id="note-color" value="#ffffff">
                    </div>
                    
                    <div style="display: flex; justify-content: flex-end; gap: 15px; margin-top: 30px;">
                        <button type="button" class="secondary-btn" id="cancel-note">取消</button>
                        <button type="submit" class="primary-btn" id="save-note">保存便签</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- 导入数据的模态框 -->
    <div class="modal" id="import-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">导入数据</h2>
                <button class="close-btn" id="close-import-modal">&times;</button>
            </div>
            
            <div class="modal-body">
                <!-- 文件导入区域 -->
                <div class="file-import-area" id="file-import-area">
                    <div class="file-import-icon">
                        <i class="fas fa-file-upload"></i>
                    </div>
                    <h3>选择文件导入</h3>
                    <p>将JSON文件拖放到此处，或点击选择文件</p>
                    <label class="file-input-label">
                        选择文件
                        <input type="file" id="file-input" class="file-input" accept=".json,application/json">
                    </label>
                    <div class="file-name" id="file-name">未选择文件</div>
                </div>
                
                <!-- 分隔线 -->
                <div style="text-align: center; margin: 20px 0; position: relative;">
                    <div style="height: 1px; background: var(--border-color);"></div>
                    <span style="position: absolute; top: -10px; background: var(--card-bg); padding: 0 15px; color: var(--text-secondary);">或</span>
                </div>
                
                <!-- 文本导入区域 -->
                <div class="form-group">
                    <label for="import-data">粘贴导出的JSON数据</label>
                    <textarea id="import-data" placeholder="在此粘贴之前导出的JSON数据..." rows="10"></textarea>
                </div>
                
                <div style="display: flex; justify-content: flex-end; gap: 15px; margin-top: 30px;">
                    <button type="button" class="secondary-btn" id="cancel-import">取消</button>
                    <button type="button" class="primary-btn" id="confirm-import">导入数据</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 设置模态框（新增） -->
    <div class="modal" id="settings-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">设置</h2>
                <button class="close-btn" id="close-settings-modal">&times;</button>
            </div>
            
            <div class="modal-body">
                <!-- 定时自动导出设置 -->
                <div class="auto-export-settings">
                    <h3 class="settings-title">
                        <i class="fas fa-clock"></i> 定时自动导出设置
                    </h3>
                    
                    <div class="settings-row">
                        <div class="settings-label">启用自动导出</div>
                        <div class="settings-control">
                            <label class="switch">
                                <input type="checkbox" id="auto-export-toggle">
                                <span class="slider round"></span>
                            </label>
                            <span id="auto-export-status">已禁用</span>
                        </div>
                    </div>
                    
                    <div class="settings-row">
                        <div class="settings-label">导出间隔</div>
                        <div class="settings-control">
                            <select id="export-interval" style="padding: 8px 12px; border-radius: 8px; border: 2px solid var(--border-color); background: var(--card-bg); color: var(--text-primary); width: 150px;">
                                <option value="15">15分钟</option>
                                <option value="30" selected>30分钟</option>
                                <option value="60">1小时</option>
                                <option value="180">3小时</option>
                                <option value="360">6小时</option>
                                <option value="720">12小时</option>
                                <option value="1440">24小时</option>
                            </select>
                            <span id="next-export-time">下次导出时间：未设置</span>
                        </div>
                    </div>
                    
                    <div class="settings-row">
                        <div class="settings-label">导出格式</div>
                        <div class="settings-control">
                            <select id="export-format" style="padding: 8px 12px; border-radius: 8px; border: 2px solid var(--border-color); background: var(--card-bg); color: var(--text-primary); width: 150px;">
                                <option value="json" selected>JSON</option>
                                <option value="txt">文本文件</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="settings-status">
                        <p>上次自动导出：<span id="last-export-time">从未</span></p>
                        <p>导出次数：<span id="export-count">0</span></p>
                    </div>
                    
                    <div class="settings-info">
                        <p><i class="fas fa-info-circle"></i> 自动导出的文件将保存在浏览器的下载文件夹中，文件名包含时间戳。</p>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 20px;">
                        <button type="button" class="secondary-btn" id="manual-export-now">立即导出</button>
                        <button type="button" class="primary-btn" id="save-settings">保存设置</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 浮动按钮 -->
    <div class="floating-buttons">
        <button class="floating-btn" id="quick-add-btn" title="快速添加">
            <i class="fas fa-plus"></i>
        </button>
        <!-- 新增：浮动设置按钮 floating-settings-btn -->
        <button class="floating-btn" id="settings-btn" title="设置">
            <i class="fas fa-cog"></i>
        </button>
        <button class="floating-btn" id="theme-toggle-btn" title="切换主题">
            <i class="fas fa-palette"></i>
        </button>
        <button class="floating-btn" id="mark-all-complete-btn" title="一键完成所有" style="background: linear-gradient(135deg, #10b981 0%, #84cc16 100%);">
            <i class="fas fa-check-double"></i>
        </button>
    </div>
    
    
    <!-- 消息提示 -->
    <div class="toast" id="toast">
        <div class="toast-content">
            <div class="toast-icon">
                <i class="fas fa-check"></i>
            </div>
            <div>
                <div class="toast-message" id="toast-message">操作成功！</div>
                <div class="toast-time" id="toast-time">刚刚</div>
            </div>
        </div>
    </div>
    
    <script>
        // 便签数据存储键
        const STORAGE_KEY = 'stickyNotesAppData';
        const THEME_KEY = 'stickyNotesTheme';
        const SETTINGS_KEY = 'stickyNotesSettings';
        const AUTO_EXPORT_KEY = 'stickyNotesAutoExport';
        
        // 当前编辑的便签ID（null表示新建）
        let currentEditId = null;
        
        // 当前排序方式
        let currentSort = 'date-desc';
        
        // 当前主题
        let currentTheme = 'theme-purple';
        
        // 分页相关
        let currentPage = 1;
        let notesPerPage = 9;
        let currentFilter = 'all';
        
        // 自动导出相关
        let autoExportInterval = null;
        let autoExportEnabled = false;
        let exportIntervalMinutes = 30;
        let exportFormat = 'json';
        let lastExportTime = null;
        let exportCount = 0;

        // 移动端优化变量
        let isMobileDevice = false;
        
        // 初始化应用
        document.addEventListener('DOMContentLoaded', function() {
            // 检测移动设备
            isMobileDevice = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            if (isMobileDevice) {
                document.body.classList.add('is-mobile');
            }
            
            loadTheme();
            loadSettings();
            loadNotes();
            setupEventListeners();
            updateNoteCount();
            
            // 添加移动端视口单位修复（防止地址栏影响高度）
            function fixVh() {
                let vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
            }
            
            fixVh();
            window.addEventListener('resize', fixVh);
            window.addEventListener('orientationchange', fixVh);
        });
        
        // 加载保存的主题
        function loadTheme() {
            const savedTheme = localStorage.getItem(THEME_KEY);
            if (savedTheme) {
                currentTheme = savedTheme;
                document.body.className = savedTheme;
                document.getElementById('theme-select').value = savedTheme;
            }
        }
        
        // 切换主题
        function switchTheme(theme) {
            document.body.className = theme;
            currentTheme = theme;
            localStorage.setItem(THEME_KEY, theme);
            document.getElementById('theme-select').value = theme;
            showToast('主题已切换！');
        }
        
        // 加载设置
        function loadSettings() {
            const savedSettings = localStorage.getItem(SETTINGS_KEY);
            if (savedSettings) {
                try {
                    const settings = JSON.parse(savedSettings);
                    autoExportEnabled = settings.autoExportEnabled || false;
                    exportIntervalMinutes = settings.exportIntervalMinutes || 30;
                    exportFormat = settings.exportFormat || 'json';
                    lastExportTime = settings.lastExportTime || null;
                    exportCount = settings.exportCount || 0;
                    
                    // 更新UI
                    document.getElementById('auto-export-toggle').checked = autoExportEnabled;
                    document.getElementById('export-interval').value = exportIntervalMinutes;
                    document.getElementById('export-format').value = exportFormat;
                    document.getElementById('last-export-time').textContent = lastExportTime ? formatDateTime(new Date(lastExportTime)) : '从未';
                    document.getElementById('export-count').textContent = exportCount;
                    
                    updateAutoExportStatus();
                    
                    // 如果启用了自动导出，则启动定时器
                    if (autoExportEnabled) {
                        startAutoExport();
                    }
                } catch (error) {
                    console.error('加载设置失败:', error);
                }
            }
        }
        
        // 保存设置
        function saveSettings() {
            const settings = {
                autoExportEnabled,
                exportIntervalMinutes,
                exportFormat,
                lastExportTime,
                exportCount
            };
            
            localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
            showToast('设置已保存！');
        }
        
        // 更新自动导出状态显示
        function updateAutoExportStatus() {
            const statusElement = document.getElementById('auto-export-status');
            const nextExportElement = document.getElementById('next-export-time');
            
            if (autoExportEnabled) {
                statusElement.textContent = '已启用';
                statusElement.style.color = 'var(--success-color)';
                
                // 计算下次导出时间
                if (autoExportInterval) {
                    const nextTime = new Date(Date.now() + exportIntervalMinutes * 60000);
                    nextExportElement.textContent = `下次导出时间：${formatTime(nextTime)}`;
                }
            } else {
                statusElement.textContent = '已禁用';
                statusElement.style.color = 'var(--text-secondary)';
                nextExportElement.textContent = '下次导出时间：未设置';
            }
        }
        
        // 启动自动导出
        function startAutoExport() {
            // 清除已有的定时器
            if (autoExportInterval) {
                clearInterval(autoExportInterval);
            }
            
            // 设置定时器
            autoExportInterval = setInterval(() => {
                autoExportData();
            }, exportIntervalMinutes * 60000); // 转换为毫秒
            
            // 立即更新状态
            updateAutoExportStatus();
            
            // 记录日志
            console.log(`自动导出已启动，间隔：${exportIntervalMinutes}分钟`);
        }
        
        // 停止自动导出
        function stopAutoExport() {
            if (autoExportInterval) {
                clearInterval(autoExportInterval);
                autoExportInterval = null;
                updateAutoExportStatus();
                console.log('自动导出已停止');
            }
        }
        
        // 自动导出数据
        function autoExportData() {
            const notes = getNotesFromStorage();
            
            if (notes.length === 0) {
                console.log('没有便签数据可导出');
                return;
            }
            
            try {
                const timestamp = adjustTime().toISOString().slice(0, 19).replace(/:/g, '');
                let dataStr, fileName, mimeType;
                
                if (exportFormat === 'txt') {
                    // 生成文本格式
                    let txtContent = `便签数据备份 - ${new Date().toLocaleString('zh-CN')}\n`;
                    txtContent += `共 ${notes.length} 条便签\n`;
                    txtContent += '='.repeat(50) + '\n\n';
                    
                    notes.forEach((note, index) => {
                        txtContent += `便签 ${index + 1}:\n`;
                        txtContent += `标题：${note.title}\n`;
                        txtContent += `创建时间：${new Date(note.date).toLocaleString('zh-CN')}\n`;
                        txtContent += `状态：${note.completed ? '已完成' : '未完成'}\n`;
                        txtContent += `标签：${note.tags ? note.tags.join(', ') : '无'}\n`;
                        txtContent += `内容：\n${note.content}\n`;
                        txtContent += '-'.repeat(40) + '\n\n';
                    });
                    
                    dataStr = txtContent;
                    fileName = `便签备份_${timestamp}.txt`;
                    mimeType = 'text/plain;charset=utf-8';
                } else {
                    // JSON格式
                    const exportData = {
                        exportDate: new Date().toISOString(),
                        totalNotes: notes.length,
                        notes: notes
                    };
                    
                    dataStr = JSON.stringify(exportData, null, 2);
                    fileName = `便签备份_${timestamp}.json`;
                    mimeType = 'application/json;charset=utf-8';
                }
                
                // 创建下载链接
                const dataUri = `data:${mimeType},${encodeURIComponent(dataStr)}`;
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', fileName);
                
                // 触发下载
                linkElement.click();
                
                // 更新统计信息
                lastExportTime = new Date().toISOString();
                exportCount++;
                
                document.getElementById('last-export-time').textContent = formatDateTime(new Date(lastExportTime));
                document.getElementById('export-count').textContent = exportCount;
                
                // 保存设置
                saveSettings();
                
                // 显示提示
                showToast(`已自动导出 ${notes.length} 条便签到 ${fileName}`, 'info');
                
                console.log(`自动导出完成：${fileName}`);
            } catch (error) {
                console.error('自动导出失败:', error);
                showToast('自动导出失败！', 'error');
            }
        }
        
        // 从本地存储加载便签
        function loadNotes() {
            const notesContainer = document.getElementById('notes-container');
            let notes = getNotesFromStorage();
            
            // 应用过滤
            notes = filterNotes(notes, currentFilter);
            
            // 清空容器
            notesContainer.innerHTML = '';
            
            if (notes.length === 0) {
                // 显示空状态
                notesContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-sticky-note"></i>
                        <h3>暂无便签</h3>
                        <p>点击"新建便签"按钮开始记录</p>
                    </div>
                `;
                
                // 隐藏分页控件
                document.getElementById('pagination-container').style.display = 'none';
                return;
            }
            
            // 对便签进行排序
            const sortedNotes = sortNotes(notes, currentSort);
            
            // 计算总页数
            const totalPages = Math.ceil(sortedNotes.length / notesPerPage);
            
            // 确保当前页面有效
            if (currentPage > totalPages) {
                currentPage = totalPages || 1;
            }
            
            // 获取当前页的数据
            const startIndex = (currentPage - 1) * notesPerPage;
            const endIndex = startIndex + notesPerPage;
            const currentPageNotes = sortedNotes.slice(startIndex, endIndex);
            
            // 渲染当前页的便签
            currentPageNotes.forEach(note => {
                const noteElement = createNoteElement(note);
                notesContainer.appendChild(noteElement);
            });
            
            // 显示分页控件
            renderPagination(totalPages);
        }
        
        // 过滤便签
        function filterNotes(notes, filterType) {
            const now = new Date();
            const todayStart = new Date(now.getFullYear(), now.getMonth(), now.getDate()).getTime();
            
            switch(filterType) {
                case 'all':
                    return notes;
                    
                case 'active':
                    return notes.filter(note => !note.completed);
                    
                case 'completed':
                    return notes.filter(note => note.completed);
                    
                case 'important':
                    return notes.filter(note => 
                        note.tags && note.tags.some(tag => 
                            tag.toLowerCase().includes('重要') || 
                            tag.toLowerCase().includes('紧急') || 
                            tag.toLowerCase().includes('priority')
                        )
                    );
                    
                case 'today':
                    return notes.filter(note => {
                        const noteDate = new Date(note.date).getTime();
                        return noteDate >= todayStart;
                    });
                    
                default:
                    return notes;
            }
        }
        
        // 排序便签函数
        function sortNotes(notes, sortType) {
            // 创建副本以避免修改原始数组
            const sortedNotes = [...notes];
            
            switch(sortType) {
                case 'date-desc':
                    // 按日期倒序排列（最新的在前）
                    return sortedNotes.sort((a, b) => new Date(b.date) - new Date(a.date));
                    
                case 'date-asc':
                    // 按日期正序排列（最早的在前）
                    return sortedNotes.sort((a, b) => new Date(a.date) - new Date(b.date));
                    
                case 'title-asc':
                    // 按标题A-Z排列
                    return sortedNotes.sort((a, b) => a.title.localeCompare(b.title, 'zh-CN'));
                    
                case 'title-desc':
                    // 按标题Z-A排列
                    return sortedNotes.sort((a, b) => b.title.localeCompare(a.title, 'zh-CN'));
                    
                case 'completed':
                    // 按完成状态排序（未完成的在前）
                    return sortedNotes.sort((a, b) => {
                        if (a.completed && !b.completed) return 1;
                        if (!a.completed && b.completed) return -1;
                        return new Date(b.date) - new Date(a.date);
                    });
                    
                default:
                    // 默认按日期倒序排列
                    return sortedNotes.sort((a, b) => new Date(b.date) - new Date(a.date));
            }
        }
        
        // 从本地存储获取便签数据
        function getNotesFromStorage() {
            const notesJSON = localStorage.getItem(STORAGE_KEY);
            const notes = notesJSON ? JSON.parse(notesJSON) : [];
            
            // 确保每个便签都有completed属性
            return notes.map(note => ({
                ...note,
                completed: note.completed || false,
                format: note.format || 'plain' // 确保有format属性
            }));
        }
        
        // 保存便签到本地存储
        function saveNotesToStorage(notes) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(notes));
        }
        
        // 创建便签DOM元素
        function createNoteElement(note) {
            const noteElement = document.createElement('div');
            noteElement.className = 'note';
            if (note.completed) {
                noteElement.classList.add('completed');
            }
            noteElement.style.backgroundColor = note.color || '#ffffff';
            
            // 格式化日期
            const date = new Date(note.date);
            const formattedDate = date.toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // 计算相对时间（例如：2小时前，3天前）
            const relativeTime = getRelativeTime(date);
            
            // 创建标签HTML
            let tagsHTML = '';
            if (note.tags && note.tags.length > 0) {
                tagsHTML = note.tags.map(tag => `<span class="tag">${tag.trim()}</span>`).join('');
            }
            
            // 根据格式渲染内容
            let contentHTML;
            if (note.format === 'markdown') {
                // 使用 marked 解析 Markdown
                try {
                    contentHTML = marked.parse(note.content, {
                        breaks: true,
                        gfm: true,
                        highlight: function(code, lang) {
                            if (lang && hljs.getLanguage(lang)) {
                                try {
                                    return hljs.highlight(code, { language: lang }).value;
                                } catch (err) {
                                    console.warn('代码高亮失败:', err);
                                }
                            }
                            return hljs.highlightAuto(code).value;
                        }
                    });
                } catch (error) {
                    console.error('Markdown解析失败:', error);
                    // 解析失败时回退到纯文本
                    contentHTML = note.content.replace(/\n/g, '<br>');
                }
            } else {
                // 纯文本：保留换行
                contentHTML = note.content.replace(/\n/g, '<br>');
            }
            
            noteElement.innerHTML = `
                ${note.completed ? '<div class="note-checkmark"><i class="fas fa-check-circle"></i></div>' : ''}
                <div class="note-header">
                    <div class="note-title">${note.title}</div>
                    <div class="note-actions">
                        <button class="note-action-btn complete-btn" data-id="${note.id}" title="${note.completed ? '标记为未完成' : '标记为完成'}">
                            <i class="fas ${note.completed ? 'fa-undo' : 'fa-check'}"></i>
                        </button>
                        <button class="note-action-btn edit-note" data-id="${note.id}" title="编辑">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="note-action-btn delete-note" data-id="${note.id}" title="删除">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                <div class="note-content ${note.format === 'markdown' ? 'markdown' : ''}">
                    ${contentHTML}
                </div>
                ${tagsHTML ? `<div class="note-tags">${tagsHTML}</div>` : ''}
                <div class="note-date">
                    <i class="far fa-clock"></i>
                    <span class="absolute-date" title="${formattedDate}">${formattedDate}</span>
                    <span class="relative-time">(${relativeTime})</span>
                    ${note.format === 'markdown' ? '<span class="format-badge">MD</span>' : ''}
                </div>
            `;
            
            // 添加事件监听器
            noteElement.querySelector('.complete-btn').addEventListener('click', () => toggleNoteComplete(note.id));
            noteElement.querySelector('.edit-note').addEventListener('click', () => editNote(note.id));
            noteElement.querySelector('.delete-note').addEventListener('click', () => deleteNote(note.id));
            
            return noteElement;
        }
        
        // 计算相对时间
        function getRelativeTime(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffSec = Math.floor(diffMs / 1000);
            const diffMin = Math.floor(diffSec / 60);
            const diffHour = Math.floor(diffMin / 60);
            const diffDay = Math.floor(diffHour / 24);
            
            if (diffSec < 60) {
                return '刚刚';
            } else if (diffMin < 60) {
                return `${diffMin}分钟前`;
            } else if (diffHour < 24) {
                return `${diffHour}小时前`;
            } else if (diffDay < 7) {
                return `${diffDay}天前`;
            } else {
                return date.toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' });
            }
        }
        
        // 格式化时间
        function formatTime(date) {
            return date.toLocaleTimeString('zh-CN', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false
            });
        }
        
        // 格式化日期时间
        function formatDateTime(date) {
            return date.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                hour12: false
            });
        }
        
        // 渲染分页控件
        function renderPagination(totalPages) {
            const paginationContainer = document.getElementById('pagination-container');
            
            if (totalPages <= 1) {
                paginationContainer.style.display = 'none';
                return;
            }
            
            paginationContainer.style.display = 'flex';
            
            let paginationHTML = '';
            
            // 上一页按钮
            paginationHTML += `
                <button class="pagination-btn" id="prev-page" ${currentPage === 1 ? 'disabled' : ''}>
                    <i class="fas fa-chevron-left"></i>
                </button>
            `;
            
            // 显示页码
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            // 第一页
            if (startPage > 1) {
                paginationHTML += `
                    <button class="pagination-btn page-btn" data-page="1">1</button>
                    ${startPage > 2 ? '<span class="pagination-dots">...</span>' : ''}
                `;
            }
            
            // 中间页码
            for (let i = startPage; i <= endPage; i++) {
                paginationHTML += `
                    <button class="pagination-btn page-btn ${i === currentPage ? 'active' : ''}" data-page="${i}">
                        ${i}
                    </button>
                `;
            }
            
            // 最后一页
            if (endPage < totalPages) {
                paginationHTML += `
                    ${endPage < totalPages - 1 ? '<span class="pagination-dots">...</span>' : ''}
                    <button class="pagination-btn page-btn" data-page="${totalPages}">${totalPages}</button>
                `;
            }
            
            // 下一页按钮
            paginationHTML += `
                <button class="pagination-btn" id="next-page" ${currentPage === totalPages ? 'disabled' : ''}>
                    <i class="fas fa-chevron-right"></i>
                </button>
            `;
            
            paginationContainer.innerHTML = paginationHTML;
            
            // 添加事件监听器
            document.getElementById('prev-page').addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    loadNotes();
                    scrollToTop();
                }
            });
            
            document.getElementById('next-page').addEventListener('click', () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    loadNotes();
                    scrollToTop();
                }
            });
            
            document.querySelectorAll('.page-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    currentPage = parseInt(this.getAttribute('data-page'));
                    loadNotes();
                    scrollToTop();
                });
            });
        }
        
        // 滚动到顶部
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // 设置事件监听器
        function setupEventListeners() {
            // 新建便签按钮
            document.getElementById('add-note-btn').addEventListener('click', () => openNoteModal());
            
            // 快速添加按钮
            document.getElementById('quick-add-btn').addEventListener('click', () => openNoteModal());
            
            // 一键完成所有按钮
            document.getElementById('mark-all-complete-btn').addEventListener('click', markAllAsComplete);
            
            // 主题切换按钮
            document.getElementById('theme-toggle-btn').addEventListener('click', cycleTheme);
            
            // 主题选择器
            document.getElementById('theme-select').addEventListener('change', function() {
                switchTheme(this.value);
            });
            
            // 关闭模态框按钮
            document.getElementById('close-modal').addEventListener('click', () => closeNoteModal());
            document.getElementById('cancel-note').addEventListener('click', () => closeNoteModal());
            
            // 便签表单提交
            document.getElementById('note-form').addEventListener('submit', saveNote);
            
            // 搜索功能
            document.getElementById('search-input').addEventListener('input', searchNotes);
            
            // 排序功能
            document.getElementById('sort-select').addEventListener('change', function() {
                currentSort = this.value;
                currentPage = 1;
                updateSortIndicator();
                loadNotes();
            });
            
            // 过滤按钮
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const filter = this.getAttribute('data-filter');
                    
                    // 更新活动按钮
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // 更新过滤条件
                    currentFilter = filter;
                    currentPage = 1;
                    loadNotes();
                });
            });
            
            // 每页显示数量选择
            document.getElementById('page-size-select').addEventListener('change', function() {
                notesPerPage = parseInt(this.value);
                currentPage = 1;
                loadNotes();
            });
            
            // 导出数据
            document.getElementById('export-btn').addEventListener('click', exportData);
            
            // 导入数据
            document.getElementById('import-btn').addEventListener('click', () => openImportModal());
            document.getElementById('close-import-modal').addEventListener('click', () => closeImportModal());
            document.getElementById('cancel-import').addEventListener('click', () => closeImportModal());
            document.getElementById('confirm-import').addEventListener('click', importData);
            
            // 清空所有便签
            document.getElementById('clear-all-btn').addEventListener('click', clearAllNotes);
            
            // 颜色选择
            document.querySelectorAll('.color-option').forEach(option => {
                option.addEventListener('click', function() {
                    const color = this.getAttribute('data-color');
                    document.getElementById('note-color').value = color;
                    
                    // 更新选中状态
                    document.querySelectorAll('.color-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    this.classList.add('selected');
                });
            });
            
            // 格式选择同步
            document.querySelectorAll('input[name="note-format"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    document.getElementById('note-format').value = this.value;
                });
            });
            
            // 点击模态框外部关闭
            <!-- window.addEventListener('click', function(event) { -->
                <!-- const noteModal = document.getElementById('note-modal'); -->
                <!-- const importModal = document.getElementById('import-modal'); -->
                <!-- const settingsModal = document.getElementById('settings-modal'); -->
                
                <!-- if (event.target === noteModal) { -->
                    <!-- closeNoteModal(); -->
                <!-- } -->
                
                <!-- if (event.target === importModal) { -->
                    <!-- closeImportModal(); -->
                <!-- } -->
                
                <!-- if (event.target === settingsModal) { -->
                    <!-- closeSettingsModal(); -->
                <!-- } -->
            <!-- }); -->
            
            // ==================== 新增功能事件监听器 ====================
            
            // 设置按钮
            document.getElementById('settings-btn').addEventListener('click', openSettingsModal);
            document.getElementById('close-settings-modal').addEventListener('click', closeSettingsModal);
            
            // 文件导入功能
            setupFileImport();
            
            // 自动导出设置
            setupAutoExportControls();
            
            // ==================== 移动端优化事件监听器 ====================
            
            // 移动端键盘弹出优化
            if (isMobileDevice) {
                // 为输入框添加触摸优化
                const inputs = document.querySelectorAll('input, textarea');
                inputs.forEach(input => {
                    input.addEventListener('focus', function() {
                        setTimeout(() => {
                            if (window.innerWidth <= 768) {
                                this.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            }
                        }, 300);
                    });
                });
            }
        }
        
        // 设置文件导入功能
        function setupFileImport() {
            const fileInput = document.getElementById('file-input');
            const fileImportArea = document.getElementById('file-import-area');
            const fileNameElement = document.getElementById('file-name');
            
            // 点击选择文件
            fileInput.addEventListener('change', function(e) {
                if (this.files && this.files.length > 0) {
                    const file = this.files[0];
                    fileNameElement.textContent = `已选择: ${file.name} (${(file.size / 1024).toFixed(2)} KB)`;
                    
                    // 自动读取文件内容
                    readFileAsText(file);
                }
            });
            
            // 拖放功能
            fileImportArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                e.stopPropagation();
                this.classList.add('dragover');
            });
            
            fileImportArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                e.stopPropagation();
                this.classList.remove('dragover');
            });
            
            fileImportArea.addEventListener('drop', function(e) {
                e.preventDefault();
                e.stopPropagation();
                this.classList.remove('dragover');
                
                if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {
                    const file = e.dataTransfer.files[0];
                    
                    // 检查文件类型
                    if (file.type !== 'application/json' && !file.name.endsWith('.json')) {
                        showToast('请选择JSON文件！', 'error');
                        return;
                    }
                    
                    fileNameElement.textContent = `已选择: ${file.name} (${(file.size / 1024).toFixed(2)} KB)`;
                    
                    // 读取文件内容
                    readFileAsText(file);
                }
            });
        }
        
        // 读取文件为文本
        function readFileAsText(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    // 将文件内容填充到文本区域
                    document.getElementById('import-data').value = content;
                    showToast('文件已加载到导入区域', 'info');
                } catch (error) {
                    console.error('读取文件失败:', error);
                    showToast('读取文件失败！', 'error');
                }
            };
            
            reader.onerror = function() {
                showToast('读取文件时发生错误！', 'error');
            };
            
            reader.readAsText(file);
        }
        
        // 设置自动导出控制
        function setupAutoExportControls() {
            // 自动导出开关
            document.getElementById('auto-export-toggle').addEventListener('change', function() {
                autoExportEnabled = this.checked;
                updateAutoExportStatus();
            });
            
            // 导出间隔选择
            document.getElementById('export-interval').addEventListener('change', function() {
                exportIntervalMinutes = parseInt(this.value);
            });
            
            // 导出格式选择
            document.getElementById('export-format').addEventListener('change', function() {
                exportFormat = this.value;
            });
            
            // 立即导出按钮
            document.getElementById('manual-export-now').addEventListener('click', function() {
                exportData();
            });
            
            // 保存设置按钮
            document.getElementById('save-settings').addEventListener('click', function() {
                // 更新设置
                if (autoExportEnabled) {
                    startAutoExport();
                } else {
                    stopAutoExport();
                }
                
                // 保存到本地存储
                saveSettings();
                
                // 关闭设置模态框
                closeSettingsModal();
            });
        }
        
        // 打开设置模态框
        function openSettingsModal() {
            openModalWithScrollLock('settings-modal');
        }
        
        // 关闭设置模态框
        function closeSettingsModal() {
            closeModalWithScrollUnlock('settings-modal');
        }
        
        // ==================== 模态框滚动优化函数 ====================
        
        // 当打开模态框时，锁定背景滚动
        function openModalWithScrollLock(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'flex';
            document.body.classList.add('modal-open');
            
            // 确保模态框内容区域滚动到顶部
            setTimeout(() => {
                const modalBody = modal.querySelector('.modal-body');
                if (modalBody) {
                    modalBody.scrollTop = 0;
                }
            }, 10);
            
            // 移动端：添加触摸事件阻止背景滚动
            if (window.innerWidth <= 768) {
                modal.addEventListener('touchmove', preventScroll, { passive: false });
            }
        }
        
        // 当关闭模态框时，恢复背景滚动
        function closeModalWithScrollUnlock(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'none';
            document.body.classList.remove('modal-open');
            
            if (window.innerWidth <= 768) {
                modal.removeEventListener('touchmove', preventScroll);
            }
        }
        
        // 阻止触摸事件的默认行为
        function preventScroll(e) {
            e.preventDefault();
        }
        
        // 切换便签完成状态
        function toggleNoteComplete(noteId) {
            const notes = getNotesFromStorage();
            const noteIndex = notes.findIndex(n => n.id === noteId);
            
            if (noteIndex !== -1) {
                notes[noteIndex].completed = !notes[noteIndex].completed;
                notes[noteIndex].date = new Date().toISOString(); // 更新修改时间
                
                saveNotesToStorage(notes);
                loadNotes();
                updateNoteCount();
                
                showToast(notes[noteIndex].completed ? '便签已标记为完成！' : '便签已标记为未完成！');
            }
        }
        
        // 一键完成所有未完成便签
        function markAllAsComplete() {
            const notes = getNotesFromStorage();
            let updatedCount = 0;
            
            notes.forEach(note => {
                if (!note.completed) {
                    note.completed = true;
                    note.date = new Date().toISOString(); // 更新修改时间
                    updatedCount++;
                }
            });
            
            if (updatedCount > 0) {
                saveNotesToStorage(notes);
                loadNotes();
                updateNoteCount();
                showToast(`已标记 ${updatedCount} 个便签为完成！`);
            } else {
                showToast('所有便签都已经完成了！', 'info');
            }
        }
        
        // 循环切换主题
        function cycleTheme() {
            const themes = [
                'theme-purple', 'theme-blue', 'theme-green', 
                'theme-pink', 'theme-orange', 'theme-dark',
                'theme-red', 'theme-cyan', 'theme-amber',
                'theme-indigo', 'theme-rose', 'theme-teal',
                'theme-fuchsia', 'theme-slate', 'theme-forest'
            ];
            const currentIndex = themes.indexOf(currentTheme);
            const nextIndex = (currentIndex + 1) % themes.length;
            switchTheme(themes[nextIndex]);
        }
        
        // 更新排序指示器
        function updateSortIndicator() {
            const sortIndicator = document.getElementById('sort-indicator');
            const sortSelect = document.getElementById('sort-select');
            const selectedOption = sortSelect.options[sortSelect.selectedIndex];
            sortIndicator.textContent = selectedOption.text;
        }
        
        // 打开便签模态框
        function openNoteModal(noteId = null) {
            currentEditId = noteId;
            const modal = document.getElementById('note-modal');
            const modalTitle = document.getElementById('modal-title');
            const form = document.getElementById('note-form');
            
            if (noteId) {
                // 编辑模式
                modalTitle.textContent = '编辑便签';
                
                // 加载便签数据
                const notes = getNotesFromStorage();
                const note = notes.find(n => n.id === noteId);
                
                if (note) {
                    document.getElementById('note-title').value = note.title;
                    document.getElementById('note-content').value = note.content;
                    document.getElementById('note-tags').value = note.tags ? note.tags.join(', ') : '';
                    document.getElementById('note-color').value = note.color || '#ffffff';
                    document.getElementById('note-format').value = note.format || 'plain';
                    
                    // 设置选中的颜色
                    document.querySelectorAll('.color-option').forEach(opt => {
                        opt.classList.remove('selected');
                        if (opt.getAttribute('data-color') === (note.color || '#ffffff')) {
                            opt.classList.add('selected');
                        }
                    });
                    
                    // 设置选中的格式
                    document.querySelectorAll('input[name="note-format"]').forEach(radio => {
                        radio.checked = radio.value === (note.format || 'plain');
                    });
                }
            } else {
                // 新建模式
                modalTitle.textContent = '新建便签';
                form.reset();
                document.getElementById('note-color').value = '#ffffff';
                document.getElementById('note-format').value = 'plain';
                
                // 重置颜色选择
                document.querySelectorAll('.color-option').forEach(opt => {
                    opt.classList.remove('selected');
                    if (opt.getAttribute('data-color') === '#ffffff') {
                        opt.classList.add('selected');
                    }
                });
                
                // 重置格式选择
                document.querySelector('input[name="note-format"][value="plain"]').checked = true;
            }
            
            openModalWithScrollLock('note-modal');
            document.getElementById('note-title').focus();
        }
        
        // 关闭便签模态框
        function closeNoteModal() {
            closeModalWithScrollUnlock('note-modal');
            currentEditId = null;
        }
        
        // 保存便签
        function saveNote(event) {
            event.preventDefault();
            
            const title = document.getElementById('note-title').value.trim();
            const content = document.getElementById('note-content').value.trim();
            const tagsInput = document.getElementById('note-tags').value.trim();
            const color = document.getElementById('note-color').value;
            const format = document.getElementById('note-format').value;
            
            if (!title || !content) {
                showToast('标题和内容不能为空！', 'error');
                return;
            }
            
            // 处理标签
            const tags = tagsInput ? tagsInput.split(',').map(tag => tag.trim()).filter(tag => tag) : [];
            
            // 获取现有便签
            const notes = getNotesFromStorage();
            
            if (currentEditId) {
                // 更新现有便签
                const noteIndex = notes.findIndex(n => n.id === currentEditId);
                if (noteIndex !== -1) {
                    notes[noteIndex] = {
                        ...notes[noteIndex],
                        title,
                        content,
                        tags,
                        color,
                        format,
                        date: new Date().toISOString() // 更新修改时间
                    };
                }
            } else {
                // 创建新便签
                const newNote = {
                    id: Date.now().toString(),
                    title,
                    content,
                    tags,
                    color,
                    format,
                    completed: false,
                    date: new Date().toISOString()
                };
                
                notes.push(newNote);
            }
            
            // 保存到本地存储
            saveNotesToStorage(notes);
            
            // 重新加载便签
            loadNotes();
            
            // 关闭模态框
            closeNoteModal();
            
            // 更新便签计数
            updateNoteCount();
            
            // 显示成功消息
            showToast(currentEditId ? '便签已更新！' : '便签已添加！');
        }
        
        // 编辑便签
        function editNote(noteId) {
            openNoteModal(noteId);
        }
        
        // 删除便签
        function deleteNote(noteId) {
            const confirmDelete = confirm('确定要删除这个便签吗？');
            if (!confirmDelete) return;
            
            const notes = getNotesFromStorage();
            const filteredNotes = notes.filter(note => note.id !== noteId);
            
            saveNotesToStorage(filteredNotes);
            loadNotes();
            updateNoteCount();
            showToast('便签已删除！');
        }
        
        // 搜索便签
        function searchNotes() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase().trim();
            const notesContainer = document.getElementById('notes-container');
            let notes = getNotesFromStorage();
            
            // 应用过滤
            notes = filterNotes(notes, currentFilter);
            
            // 清空容器
            notesContainer.innerHTML = '';
            
            if (searchTerm === '') {
                // 如果没有搜索词，显示所有便签（按当前过滤和排序方式）
                loadNotes();
                return;
            }
            
            // 过滤便签
            const filteredNotes = notes.filter(note => {
                return note.title.toLowerCase().includes(searchTerm) || 
                       note.content.toLowerCase().includes(searchTerm) ||
                       (note.tags && note.tags.some(tag => tag.toLowerCase().includes(searchTerm)));
            });
            
            if (filteredNotes.length === 0) {
                // 显示无结果状态
                notesContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <h3>未找到匹配的便签</h3>
                        <p>尝试使用其他关键词搜索</p>
                    </div>
                `;
                
                // 隐藏分页控件
                document.getElementById('pagination-container').style.display = 'none';
                return;
            }
            
            // 对搜索结果进行排序
            const sortedNotes = sortNotes(filteredNotes, currentSort);
            
            // 计算总页数
            const totalPages = Math.ceil(sortedNotes.length / notesPerPage);
            
            // 确保当前页面有效
            if (currentPage > totalPages) {
                currentPage = totalPages || 1;
            }
            
            // 获取当前页的数据
            const startIndex = (currentPage - 1) * notesPerPage;
            const endIndex = startIndex + notesPerPage;
            const currentPageNotes = sortedNotes.slice(startIndex, endIndex);
            
            // 显示过滤后的便签
            currentPageNotes.forEach(note => {
                const noteElement = createNoteElement(note);
                notesContainer.appendChild(noteElement);
            });
            
            // 显示分页控件
            renderPagination(totalPages);
        }

        function adjustTime() {
          const date = new Date();
          const adjustedDate = new Date(date.getTime() + 8 * 3600 * 1000); // 增加8小时
          return adjustedDate;
        }
        
        // 导出数据
        function exportData() {
            const notes = getNotesFromStorage();
            
            if (notes.length === 0) {
                showToast('没有可导出的便签数据！', 'warning');
                return;
            }
            
            const timestamp = adjustTime().toISOString().slice(0, 19).replace(/:/g, '');
            const dataStr = JSON.stringify(notes, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `便签数据_${timestamp}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showToast(`已导出 ${notes.length} 条便签！`);
        }
        
        // 打开导入模态框
        function openImportModal() {
            openModalWithScrollLock('import-modal');
            document.getElementById('import-data').focus();
            // 重置文件选择状态
            document.getElementById('file-name').textContent = '未选择文件';
            document.getElementById('file-input').value = '';
        }
        
        // 关闭导入模态框
        function closeImportModal() {
            closeModalWithScrollUnlock('import-modal');
            document.getElementById('import-data').value = '';
            // 重置文件选择状态
            document.getElementById('file-name').textContent = '未选择文件';
            document.getElementById('file-input').value = '';
        }
        
        // 导入数据
        function importData() {
            const importDataText = document.getElementById('import-data').value.trim();
            
            if (!importDataText) {
                showToast('请输入要导入的数据！', 'error');
                return;
            }
            
            try {
                const importedNotes = JSON.parse(importDataText);
                
                // 检查是否是我们导出的格式（数组或包含notes的对象）
                let notesToImport;
                if (Array.isArray(importedNotes)) {
                    notesToImport = importedNotes;
                } else if (importedNotes.notes && Array.isArray(importedNotes.notes)) {
                    notesToImport = importedNotes.notes;
                } else {
                    throw new Error('导入的数据格式不正确！');
                }
                
                // 验证每个便签对象
                for (let note of notesToImport) {
                    if (!note.id || !note.title || !note.content || !note.date) {
                        throw new Error('导入的数据格式不正确！');
                    }
                }
                
                // 合并数据（避免重复ID）
                const existingNotes = getNotesFromStorage();
                const existingIds = new Set(existingNotes.map(note => note.id));
                
                // 过滤掉ID重复的便签
                const newNotes = notesToImport.filter(note => !existingIds.has(note.id));
                
                if (newNotes.length === 0) {
                    showToast('没有新的便签可导入（所有便签ID都已存在）！', 'warning');
                    closeImportModal();
                    return;
                }
                
                // 合并便签
                const mergedNotes = [...existingNotes, ...newNotes];
                
                // 保存到本地存储
                saveNotesToStorage(mergedNotes);
                
                // 重新加载便签
                loadNotes();
                
                // 更新便签计数
                updateNoteCount();
                
                // 关闭模态框
                closeImportModal();
                
                // 显示成功消息
                showToast(`成功导入 ${newNotes.length} 个便签！`);
                
            } catch (error) {
                showToast('导入失败：' + error.message, 'error');
            }
        }
        
        // 清空所有便签
        function clearAllNotes() {
            const confirmClear = confirm('确定要清空所有便签吗？此操作不可撤销！');
            if (!confirmClear) return;
            
            localStorage.removeItem(STORAGE_KEY);
            loadNotes();
            updateNoteCount();
            showToast('所有便签已清空！');
        }
        
        // 更新便签计数
        function updateNoteCount() {
            const notes = getNotesFromStorage();
            const totalNotes = notes.length;
            const completedNotes = notes.filter(note => note.completed).length;
            
            document.getElementById('note-count').textContent = totalNotes;
            document.getElementById('completed-count').textContent = completedNotes;
        }
        
        // 显示提示消息
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            const toastIcon = toast.querySelector('.toast-icon i');
            
            // 设置消息内容
            toastMessage.textContent = message;
            
            // 设置图标和颜色
            const now = new Date();
            const timeStr = now.toLocaleTimeString('zh-CN', {hour: '2-digit', minute: '2-digit'});
            document.getElementById('toast-time').textContent = timeStr;
            
            if (type === 'error') {
                toast.style.borderLeftColor = '#ef4444';
                toastIcon.className = 'fas fa-exclamation-circle';
            } else if (type === 'warning') {
                toast.style.borderLeftColor = '#f59e0b';
                toastIcon.className = 'fas fa-exclamation-triangle';
            } else if (type === 'info') {
                toast.style.borderLeftColor = '#3b82f6';
                toastIcon.className = 'fas fa-info-circle';
            } else {
                toast.style.borderLeftColor = 'var(--primary-color)';
                toastIcon.className = 'fas fa-check';
            }
            
            // 显示提示
            toast.classList.add('show');
            
            // 3秒后隐藏
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        
        // 添加一些示例数据（如果没有数据）
        function addSampleDataIfEmpty() {
            const notes = getNotesFromStorage();
            if (notes.length === 0) {
                const now = new Date();
                const sampleNotes = [
                    {
                        id: "1",
                        title: "欢迎使用便签记事本",
                        content: `# 欢迎使用便签记事本

这是一个**功能完整**的便签记事应用，采用现代化设计。

## ✨ 主要功能

### 基础功能
✅ 创建、编辑、删除便签  
✅ 15种配色方案切换  
✅ 便签颜色个性化  
✅ 标签分类管理  

### 高级功能
✅ 搜索和排序功能  
✅ 数据导入/导出（支持文件导入）  
✅ 定时自动导出功能  
✅ 响应式设计，支持移动设备  
✅ 分页显示和一键完成功能！  
✅ **Markdown 语法支持**（现在可用！）

## 📝 Markdown 示例

\`\`\`javascript
// 这是一个代码示例
function helloWorld() {
    console.log("Hello, World!");
    return true;
}
\`\`\`

**粗体文本** 和 *斜体文本*

> 引用块：这是引用文本

- 列表项 1
- 列表项 2
- 列表项 3

1. 有序项 1
2. 有序项 2
3. 有序项 3

[这是一个链接](https://example.com)`,
                        tags: ["欢迎", "说明", "新功能"],
                        color: "#ffffff",
                        format: "markdown",  // 新增
                        completed: false,
                        date: new Date(now.getTime() - 2 * 24 * 60 * 60 * 1000).toISOString()
                    },
                    {
                        id: "2",
                        title: "购物清单",
                        content: "本周购物清单：\n\n🥛 牛奶 2盒\n🥚 鸡蛋 1打\n🍞 全麦面包\n🍎 苹果、香蕉\n🥦 西兰花、胡萝卜\n🥩 鸡胸肉 500g\n🧀 芝士片",
                        tags: ["购物", "清单", "生活"],
                        color: "#e6f7ff",
                        format: "plain",
                        completed: true,
                        date: new Date(now.getTime() - 1 * 24 * 60 * 60 * 1000).toISOString()
                    },
                    {
                        id: "3",
                        title: "项目会议要点",
                        content: `## 项目进度汇报会议记录

### 📊 当前进度：75%
- 前端开发：已完成
- 后端API：90%
- 数据库设计：100%
- 测试用例：60%

### 🎯 下阶段目标：完成UI优化
1. 优化响应式设计
2. 添加暗色模式
3. 提高页面加载速度

### 👥 团队分工调整
| 成员 | 负责模块 | 截止日期 |
|------|----------|----------|
| 张三 | 前端界面 | 12/10 |
| 李四 | 后端API | 12/12 |
| 王五 | 测试 | 12/15 |

### ⏰ 截止日期：12月15日

### ⚠️ 风险点
- 第三方API延迟
- 浏览器兼容性问题
- 服务器部署配置`,
                        tags: ["工作", "会议", "重要", "项目"],
                        color: "#fff9e6",
                        format: "markdown",  // 新增
                        completed: false,
                        date: new Date().toISOString()
                    }
                ];
                
                saveNotesToStorage(sampleNotes);
                loadNotes();
                updateNoteCount();
                updateSortIndicator();
                showToast('已加载示例数据！');
            }
        }
        
        // 在页面加载后添加示例数据
        setTimeout(addSampleDataIfEmpty, 800);
    </script>
</body>
</html>